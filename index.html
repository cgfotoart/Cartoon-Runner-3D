<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cartoon Runner 3D</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; font-family:Arial, sans-serif; color:white; }
    #hud {
      position: absolute; top: 10px; left: 10px; z-index: 10; font-size: 16px; background: rgba(0,0,0,0.5);
      padding: 8px; border-radius: 6px;
    }
    button {
      background: orange; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;
    }
    #minimap {
      position: absolute; top: 10px; right: 10px; width: 120px; height: 120px; background: #111;
      border: 2px solid #fff; border-radius: 50%; z-index: 10;
    }
  </style>
</head>
<body>
  <div id="hud">
    üç© Donuts: <span id="donuts">0</span> / 10 <br>
    ‚ù§Ô∏è HP: <span id="hp">3</span> ‚è± Zeit: <span id="time">0.0</span>s <br>
    <button id="perfBtn">Leistung: Hoch</button>
    <button id="resetBtn">Neu starten (R)</button>
  </div>
  <canvas id="minimap"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/PointerLockControls.js"></script>
  <script>
    // Basis-Szene
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222244);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Licht
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5,10,7);
    scene.add(light);

    // Boden
    const groundGeo = new THREE.PlaneGeometry(100, 100);
    const groundMat = new THREE.MeshStandardMaterial({color:0x228822});
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI/2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Donuts
    const donuts = [];
    const donutGeo = new THREE.TorusGeometry(0.5, 0.2, 16, 32);
    const donutMat = new THREE.MeshStandardMaterial({color:0xffaa00});
    for(let i=0;i<10;i++){
      const donut = new THREE.Mesh(donutGeo, donutMat);
      donut.position.set(Math.random()*40-20, 0.5, Math.random()*40-20);
      scene.add(donut);
      donuts.push(donut);
    }

    // Gegner
    const enemies = [];
    const enemyGeo = new THREE.BoxGeometry(1,1,1);
    const enemyMat = new THREE.MeshStandardMaterial({color:0xff0000});
    for(let i=0;i<3;i++){
      const enemy = new THREE.Mesh(enemyGeo, enemyMat);
      enemy.position.set(Math.random()*30-15, 0.5, Math.random()*30-15);
      scene.add(enemy);
      enemies.push(enemy);
    }

    // Steuerung
    const controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', ()=>{ controls.lock(); });

    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const keys = {};
    document.addEventListener('keydown', e=>{ keys[e.code]=true; if(e.code==='KeyR') resetGame(); });
    document.addEventListener('keyup', e=>{ keys[e.code]=false; });

    camera.position.set(0, 1.6, 5);

    let donutCount = 0;
    let hp = 3;
    let time = 0;

    function resetGame(){
      donutCount=0; hp=3; time=0;
      camera.position.set(0,1.6,5);
      donuts.forEach(d=>{d.visible=true;});
      document.getElementById('donuts').textContent = donutCount;
      document.getElementById('hp').textContent = hp;
    }

    document.getElementById('perfBtn').onclick = ()=>{
      if(renderer.getPixelRatio() > 1){
        renderer.setPixelRatio(1);
        document.getElementById('perfBtn').textContent = "Leistung: Niedrig";
      } else {
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('perfBtn').textContent = "Leistung: Hoch";
      }
    };
    document.getElementById('resetBtn').onclick = resetGame;

    // Minimap
    const minimap = document.getElementById('minimap').getContext('2d');

    // Animation
    function animate(){
      requestAnimationFrame(animate);
      time += 0.016;
      document.getElementById('time').textContent = time.toFixed(1);

      // Bewegung
      direction.z = Number(keys['KeyW']) - Number(keys['KeyS']);
      direction.x = Number(keys['KeyD']) - Number(keys['KeyA']);
      direction.normalize();

      const speed = 0.1;
      if(controls.isLocked){
        velocity.x = direction.x * speed;
        velocity.z = direction.z * speed;
        controls.moveRight(velocity.x);
        controls.moveForward(velocity.z);
      }

      // Donut einsammeln
      donuts.forEach(d=>{
        if(d.visible && camera.position.distanceTo(d.position) < 1){
          d.visible = false;
          donutCount++;
          document.getElementById('donuts').textContent = donutCount;
        }
      });

      // Gegner-Kollision
      enemies.forEach(e=>{
        e.position.x += Math.sin(time + e.position.z) * 0.02;
        if(camera.position.distanceTo(e.position) < 1){
          hp--;
          document.getElementById('hp').textContent = hp;
          if(hp <= 0){ resetGame(); }
        }
      });

      // Minimap zeichnen
      minimap.clearRect(0,0,120,120);
      minimap.fillStyle = 'yellow';
      donuts.forEach(d=>{ if(d.visible){ minimap.fillRect(60+d.position.x, 60+d.position.z, 2,2);} });
      minimap.fillStyle = 'red';
      enemies.forEach(e=>{ minimap.fillRect(60+e.position.x, 60+e.position.z, 2,2); });
      minimap.fillStyle = 'blue';
      minimap.fillRect(60+camera.position.x, 60+camera.position.z, 2,2);

      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
